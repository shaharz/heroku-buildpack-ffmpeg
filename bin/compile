#!/bin/sh

set -e

BUILD_DIR=$1
CACHE_DIR=$2

# Buildpack URL
ARCHIVE_NAME=vips-heroku
FILE_NAME=${ARCHIVE_NAME}.tar.gz
BUILDPACK_PACKAGE=http://pm-tiles-staging.s3-website-us-east-1.amazonaws.com/${FILE_NAME}

mkdir -p $CACHE_DIR
if ! [ -e $CACHE_DIR/$FILE_NAME ]; then
  echo "-----> Fetching VIPS binaries at ${BUILDPACK_PACKAGE}"
  curl $BUILDPACK_PACKAGE -o $CACHE_DIR/$FILE_NAME
fi

echo "-----> Extracting VIPS binaries to ${BUILD_DIR}/vips"
mkdir -p $CACHE_DIR/$ARCHIVE_NAME
# mkdir -p $BUILD_DIR/vendor
tar zxf $CACHE_DIR/$FILE_NAME -C $CACHE_DIR
mv $CACHE_DIR/vips $BUILD_DIR/vips

echo $PKG_CONFIG_PATH
ls /app/*